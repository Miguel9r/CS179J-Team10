#include <CurieBLE.h>

/**
* This is for the flash system once the the ble sample works with our android application
* Change to ArduinoBLE.h library
*/

BLEPeripheral blePeripheral; // create peripheral instance
BLEService flashService("63874698-5eb2-4a49-b0b5-fcb036c303ee"); // create flash service

BLECharCharacteristic photoResistorCharacteristic("91261960-e1f0-4e3a-bdd2-fc35ccef22ca", BLERead);
BLECharCharacteristic ledCharacteristic("", BLERead | BLEWrite);

const int pResistor = A0;
const int ledPin = 9;

int value;
void setup() {
  Serial.begin(9600);
  // put your setup code here, to run once:
  pinMode(ledPin, OUTPUT);
  pinMode(pResistor, INPUT);

 // set the local name peripheral advertises
  blePeripheral.setLocalName("Flash System");
  // set the UUID for the service this peripheral advertises:
  blePeripheral.setAdvertisedServiceUuid(flashService.uuid());


  blePeripheral.addAttribute(flashService);
  blePeripheral.addAttribute(ledCharacteristic);
  blePeripheral.addAttribute(photoResistorCharacteristic);

  ledCharacteristic.setValue(0);

   blePeripheral.begin();

   Serial.println("Bluetooth device active, waiting for connections...");

}

void loop() {
  // put your main code here, to run repeatedly:
  blePeripheral.poll();

  value = analogRead(pResistor);
  Serial.print("Value: "); Serial.println(value);

  if(value > 30)
  {
    digitalWrite(ledPin, LOW);
  }
  else
  {
    digitalWrite(ledPin, HIGH);
  }

  delay(250);
}